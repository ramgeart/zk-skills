---
name: ssh-sheller
description: Execute SSH operations (connect, run commands, create tunnels, SCP file transfer) and manage SSH server configurations with automatic bootstrap. Use when the user wants to connect to remote servers via SSH, execute commands on remote servers, create SSH tunnels/port forwarding, transfer files using SCP, manage server configurations, or generate SSH keys. Automatically offers to create configuration if not found. Reads server credentials from sheller.yaml configuration file.
---

# SSH Sheller

Execute SSH operations using native `ssh` and `scp` commands with credentials stored in YAML configuration. Automatically bootstraps configuration if not found.

## Features

- **Automatic Bootstrap**: Offers to create configuration if `sheller.yaml` not found
- **Server Management**: Add, list, remove, and show server configurations
- **SSH Key Generation**: Generate ed25519 keys (preferred) with one command
- **Secure Storage**: Keys are referenced by path only (never stored in YAML)
- **Cross-Platform**: Works on Windows, macOS, and Linux

## Configuration

Create a `sheller.yaml` file in either:
1. **Skill root directory** (checked first)
2. **`~/.ssh/sheller.yaml`** (Windows: `%USERPROFILE%\.ssh\sheller.yaml`)

See [assets/sheller.yaml.example](assets/sheller.yaml.example) for a complete example.

### Configuration Format

```yaml
servers:
  web-prod:
    host: 192.168.1.100
    user: ubuntu
    key_file: ~/.ssh/id_ed25519
  
  db-server:
    host: db.example.com
    user: root
    port: 2222
    key_file: C:/Users/me/.ssh/db_key
    # Password can be stored (optional, for backup)
    password: secret123
```

**Important:**
- `key_file` contains the **path** to the private key, never the key content
- Keys are always ed25519 when generated by this tool
- Passwords can be stored in plain text (use keys for better security)

## Commands

### Connection & Operations

| Command | Description |
|---------|-------------|
| `connect <server>` | Interactive SSH session |
| `exec <server> "<command>"` | Execute command remotely |
| `tunnel <server> --local L --remote R` | Create port forwarding |
| `upload <server> <local> <remote>` | Upload file via SCP |
| `download <server> <remote> <local>` | Download file via SCP |
| `raw <server> <args...>` | Raw SSH with custom arguments |

### Server Management

| Command | Description |
|---------|-------------|
| `init` | Create empty configuration file |
| `add-server` | Interactively add new server |
| `list-servers` | Show all configured servers |
| `show-server <name>` | Show detailed server config |
| `remove-server <name>` | Remove server from config |
| `generate-key <path>` | Generate new ed25519 key pair |

## Usage Examples

### First-Time Setup (Bootstrap)

When you run any command without a config file:

```bash
python scripts/ssh_sheller.py list-servers
# No configuration file found.
# 
# Would you like to:
# 1. Create a new configuration file
# 2. Specify an existing config file path
# 3. Exit
```

Or create manually:

```bash
# Initialize config (interactive)
python scripts/ssh_sheller.py init

# Add first server (interactive wizard)
python scripts/ssh_sheller.py add-server
```

### SSH Operations

```bash
# Connect interactively
python scripts/ssh_sheller.py web-prod connect

# Execute command
python scripts/ssh_sheller.py web-prod exec "ls -la /var/log"

# Create tunnel (local 4949 -> remote 3000)
python scripts/ssh_sheller.py web-prod tunnel --local 4949 --remote 3000

# Upload file
python scripts/ssh_sheller.py web-prod upload ./backup.zip /home/admin/

# Download file
python scripts/ssh_sheller.py web-prod download /etc/nginx/nginx.conf ./
```

### Server Management

```bash
# List all servers
python scripts/ssh_sheller.py list-servers

# Show server details
python scripts/ssh_sheller.py show-server web-prod

# Generate new ed25519 key
python scripts/ssh_sheller.py generate-key ~/.ssh/prod_key

# Add server interactively
python scripts/ssh_sheller.py add-server
# Prompts for: name, host, user, port, key file (or generate new)

# Remove server
python scripts/ssh_sheller.py remove-server old-server
```

## Common User Requests

When user asks for:

| Request | Action |
|---------|--------|
| "Conectarme al servidor X" | `connect` |
| "Ejecutar comando Y en servidor X" | `exec "Y"` |
| "Crear t√∫nel al puerto Z del servidor X" | `tunnel --local <L> --remote Z` |
| "Copiar archivo A al servidor X" | `upload A <dest>` |
| "Descargar archivo B del servidor X" | `download B <dest>` |
| "Agregar nuevo servidor" | `add-server` (interactive) |
| "Generar clave SSH" | `generate-key <path>` |
| "Listar mis servidores" | `list-servers` |

Always use the script path relative to the skill directory.

## Windows Compatibility

- Paths with `~` are expanded automatically to `%USERPROFILE%`
- Both forward slashes (`/`) and backslashes (`\`) work in paths
- SSH client must be installed (Git Bash, Windows OpenSSH, or WSL)
- Key files work with OpenSSH for Windows

## Security Notes

1. **Key Files**: Only store the path to private keys, never the key content
2. **Key Generation**: Always uses ed25519 algorithm when generating new keys
3. **Permissions**: Generated keys get 0600 permissions (Unix) or best effort (Windows)
4. **Passwords**: Can be stored in YAML but keys are recommended
